<configuration debug="true">

    <property name="LOG_HOME" value="/Users/milton/jvmxray-agent/logs" />
    <property name="MSG_FMT_SM" value="%d{YYYY.MM.dd 'at' HH:mm:ss z} | %logger{1} | %X | %5level | %msg%n" />
    <property name="MSG_FMT_LG" value="%d{YYYY.MM.dd 'at' HH:mm:ss.SSS z} | %logger | %X | %5level | %msg%n" />
    <property name="MSG_FMT_MACHINE" value="%d{yyyy-MM-dd'T'HH:mm:ss.SSS'Z', GMT},%logger,%X{key}{|},%5level,%msg%n" />

    <appender name="consoledest" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${MSG_FMT_SM}</pattern>
        </encoder>
    </appender>

    <appender name="csvdest" class="ch.qos.logback.core.FileAppender">
        <file>${LOG_HOME}/jvmxrayagent-events.csv</file>
        <encoder class="org.jvmxray.logging.contrib.CSVEncoder">
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>${MSG_FMT_MACHINE}</pattern>
            </layout>
        </encoder>
    </appender>

    <appender name="rollingfiledest" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_HOME}/jvmxrayagent-events.txt</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${LOG_HOME}/bkup/jvmxray-agent-%d{yyyy-MM-dd-HH-mm-ss-SSS}-%i.log.gz</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>10</maxHistory>
        </rollingPolicy>
        <encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>${MSG_FMT_LG}</pattern>
            </layout>
        </encoder>
    </appender>

    <!-- Rathole operator messages to the console window only for now.  -->
    <logger name="org.jvmxray.agent.driver.jvmxraysecuritymanager" level="INFO" additivity="false">
        <appender-ref ref="consoledest" />
    </logger>

    <logger name="org.jvmxray.agent.driver.jvmxraysecuritymanager.events" level="WARN" additivity="false">
        <appender-ref ref="consoledest" />
        <appender-ref ref="csvdest" />
    </logger>

    <logger name="org.jvmxray.agent.driver.jvmxraysecuritymanager.events.fileexecute" level="DEBUG" />
    <logger name="org.jvmxray.agent.driver.jvmxraysecuritymanager.events.permission" additivity="false" level="OFF" />
    <logger name="org.jvmxray.agent.driver.jvmxraysecuritymanager.events.permissionwithcontext" additivity="false" level="OFF" />

    <root level="INFO">
        <appender-ref ref="consoledest" />
        <appender-ref ref="csvdest" />
    </root>

</configuration>
